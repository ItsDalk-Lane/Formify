# MVP #022: AI Action 实现

## 状态: pending

## 目标
实现表单的 AI 动作，支持流式输出显示。

## 功能边界
- [x] AIActionService 类
- [x] AIStreamingModal（流式输出模态框）
- [x] AI 结果到 FormState
- [x] 提示词模板处理

## 不做
- Tool Calling
- 多轮对话

## 验收标准
1. AI 动作能正确调用 Provider
2. 流式输出能实时显示
3. 结果能存入指定变量

## 依赖
- MVP011（Action Chain）
- MVP021（OpenAI Provider）

## 参考代码
```typescript
// src/service/action/ai/AIActionService.ts
export class AIActionService implements IActionService {
  accept(action: IFormAction): boolean {
    return action.type === FormActionType.AI;
  }

  async run(action: AIFormAction, context: ActionContext, chain: ActionChain): Promise<void> {
    const provider = getProvider(action.providerTag);
    const prompt = FormTemplateProcessEngine.process(action.prompt, context.state, context.app);

    if (action.showModal) {
      const modal = new AIStreamingModal(context.app);
      modal.open();
      let result = '';
      for await (const chunk of provider.chatStream([{ role: 'user', content: prompt }])) {
        result += chunk;
        modal.updateContent(result);
      }
      modal.setComplete();
      context.state.setValue(action.outputVariable, result);
    } else {
      const result = await provider.chat([{ role: 'user', content: prompt }]);
      context.state.setValue(action.outputVariable, result);
    }

    await chain.next(context);
  }
}
```

## 预估时间
90-120 分钟
