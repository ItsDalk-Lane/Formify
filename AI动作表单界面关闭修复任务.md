# 修复任务提示词

## 背景：表单提交流程与AI动作执行机制

当前项目中，表单提交功能支持配置多种动作类型，包括AI动作。表单提交流程主要涉及以下组件：

1. **表单渲染视图** (`CpsFormRenderView.tsx`)：负责表单的渲染和提交逻辑，支持执行超时控制功能
2. **表单服务** (`FormService.ts`)：处理表单提交，创建动作链并顺序执行所有配置的动作
3. **动作链执行器** (`IActionService.ts`)：按照顺序依次执行表单配置的所有动作
4. **AI动作服务** (`AIActionService.ts`)：执行AI调用，支持通过独立的流式输出模态框 (`AIStreamingModal`) 显示AI生成内容

当表单启用了执行超时控制功能时，当前的实现逻辑是：表单界面会保持打开状态，直到所有动作执行完成后才关闭。这个设计的初衷是让用户能够在执行期间通过停止按钮中断长时间运行的动作。

## 问题描述

当表单中配置了AI动作时，存在以下两个问题：

**问题一**：点击提交按钮后，表单输入界面不会立即消失，而是需要等待AI动作执行完成（即AI的流式输出全部显示完毕）后才会关闭。这与执行其他非AI动作时的用户体验不一致。

**问题二**：如果在AI动作执行期间手动点击表单界面的关闭按钮，会触发 `abortSignal` 中断信号，导致正在执行的AI动作被直接中断。

**触发条件**：
1. 表单配置中启用了执行超时控制功能 (`enableExecutionTimeout = true`)
2. 表单的动作列表中包含AI动作
3. 用户点击表单的提交按钮，或在AI执行期间手动关闭表单界面

**当前行为**：
- 表单界面在动作链执行完毕后关闭
- 手动关闭表单界面会中断AI动作的执行

**期望行为**：
- 点击提交按钮后，表单输入界面立即关闭
- AI动作在后台继续执行，不受表单界面关闭的影响
- AI的流式输出在独立的 `AIStreamingModal` 中正常显示
- 表单界面的关闭操作（无论是自动关闭还是手动关闭）不影响已启动的AI动作执行

## 验收标准

1. 当表单中包含AI动作时，点击提交按钮后表单界面应立即关闭
2. AI动作应在后台继续正常执行，流式输出在 `AIStreamingModal` 中正常显示
3. 手动关闭表单界面不应中断正在执行的AI动作
4. 表单中其他非AI动作的执行行为不受影响，保持原有逻辑
5. 如果表单中没有AI动作，保持当前的执行行为不变
6. AI动作执行完成后，如果配置了后续动作，应能正常继续执行
7. 修复后需要确保不破坏现有的执行超时控制和停止按钮功能

## 边界情况和兼容性要求

1. 需要考虑AI动作在动作链中的位置（开头、中间、结尾），确保各种位置下的行为正确
2. 需要考虑表单中同时包含多个AI动作的情况
3. 需要考虑AI动作执行失败或被中断的情况，确保表单界面能正确处理
4. 需要保持向下兼容性，不影响未启用执行超时控制的表单行为
5. 需要确保修改不影响其他类型动作的执行（如创建文件、插入文本、运行命令等）
6. 如果AI动作之前有其他动作，这些动作应该在表单界面关闭前执行完成
7. 修复时应最小化代码改动范围，避免引入新的复杂性
