在此Obsidian插件项目中添加一个新的表单动作"文本"的功能。该动作包含两个主要子功能：文本操作和文本清理。本次实现将先完成文本清理子功能的设置，文本操作暂时只留一个接口以供后续开发。文本清理子功能具备的子功能有：清除文本格式功能，删除文件/文件夹功能，删除文件内容功能。这些功能的详细介绍如下所示：

## 一、清除文本格式功能:
```markdown
### 功能目标与预期效果

本功能旨在为用户提供一种便捷方式，清除Markdown文档中的各类格式标记，同时保留原始文本内容。用户可以根据需要选择性地清除特定类型的格式，也可以一键清除所有格式，将格式化文档转换为纯文本。

### 功能需求详细描述

1. **文件来源设置**
   - 支持设置文件来源为当前文件或指定文件
   - 指定文件时只能选择以.md结尾的Markdown格式文件
   - 支持批量处理多个文件

2. **处理流程**
   - 读取文件内容
   - 根据用户选择的格式类型，应用相应的正则表达式替换
   - 清理多余的空行
   - 将处理后的内容写回文件
   - 记录处理日志和清除的格式类型

3. **可清除的文本格式**

#### 基础文本格式
- 粗体格式：`**粗体文本**` 和 `__粗体文本__`
- 斜体格式：`*斜体文本*` 和 `_斜体文本_`
- 删除线格式：`~~删除线文本~~`
- 高亮格式：`==高亮文本==`
- 行内代码格式：`` `代码` ``

#### 链接与媒体格式
- 链接格式：`[链接文本](链接地址)` → `链接文本`
- 图片格式：`![图片描述](图片地址)` → `图片描述`

#### 文档结构格式
- 标题格式：`# 一级标题`、`## 二级标题`等
- 引用格式：`> 引用文本`、`>> 嵌套引用`
- 列表格式：`- 项目`、`* 项目`、`+ 项目`、`1. 项目`等
- 表格格式：将表格转换为空格分隔的纯文本

#### 高级格式
- 注释格式：`%% 注释内容 %%`、`<!-- 注释内容 -->`
- 脚注格式：`[^1]`和`[^1]: 脚注内容`
- 数学公式格式：`$$ 数学公式 $$`、`$ 数学公式 $`
- 属性格式：YAML前置元数据（frontmatter）

### Obsidian兼容性要求

- 与Obsidian API兼容，使用Obsidian提供的文件操作接口
- 遵循Obsidian插件开发规范，确保不影响Obsidian核心功能
- 支持Obsidian的明暗主题切换
- 适配Obsidian移动端和桌面端的不同显示尺寸

### 性能与安全考虑

- 处理大文件时采用异步操作，避免界面卡顿
- 在执行不可逆操作前提供确认机制
- 操作完成后提供状态反馈
- 添加错误处理机制，确保操作失败时不会损坏原始文件
- 提供操作日志，便于用户了解具体执行了哪些清理操作

### 设置界面详细描述

界面使用组件作为基础容器，每个设置项都包含在一个独立的表单项中，具有清晰的标签、描述和控制区域。

界面整体采用水平布局模式，左侧为信息区域（包含标签和描述），右侧为控制区域（包含各种交互控件）。各表单项之间通过细线分隔，并带有悬停效果，提升用户体验。

#### 设置项详细描述

##### 1. 目标模式选择

这是界面的第一个设置项，位于"清除文本格式"功能配置区域的顶部。

- **控件类型**：下拉选择框
- **标签**："目标模式"
- **描述**："选择要操作的文件来源"
- **选项**：
  - "current"（当前文件）
  - "specified"（指定文件）
- **默认状态**：当前文件
- **功能说明**：用户可以选择是对当前活动文件进行格式清除，还是对指定的多个文件进行批量处理。

##### 2. 目标文件配置（条件显示）

当用户选择"指定文件"模式时，会显示此设置项。

- **控件类型**：文件路径列表（动态添加/删除）
- **标签**："目标文件"
- **描述**："指定要处理的文件路径，支持多个文件"
- **界面元素**：
  - 文件路径输入框（支持自动补全和文件选择）
  - 添加按钮（带加号图标）
  - 删除按钮（带垃圾桶图标）
- **功能说明**：用户可以添加多个文件路径，系统会依次处理这些文件。每个文件路径输入框都支持Obsidian的文件选择功能，并可以使用表单字段变量。

##### 3. 一键清除所有格式

这是格式清除功能的核心开关选项。

- **控件类型**：Toggle滑动开关
- **标签**："一键清除所有格式"
- **描述**："开启后将清除所有文本格式，忽略下方的单独设置"
- **默认状态**：关闭
- **视觉特征**：
  - 中等尺寸的滑动开关（宽度40px，高度22px）
  - 关闭状态为灰色背景，开启状态为蓝色背景
  - 滑块为白色圆形，带有轻微阴影效果
- **功能说明**：当开启此选项时，系统将清除所有支持的文本格式，无需用户单独选择下方的格式选项。

##### 4. 基础格式选择（条件显示）

当"一键清除所有格式"关闭时，显示此设置项。

- **控件类型**：MultiSelect多选下拉框
- **标签**："基础格式"
- **描述**："选择要清除的基础文本格式"
- **占位符**："选择要清除的基础格式"
- **选项列表**：
  1. "清除粗体格式"（描述：**文本** 和 __文本__）
  2. "清除斜体格式"（描述：*文本* 和 _文本_）
  3. "清除删除线格式"（描述：~~文本~~）
  4. "清除高亮格式"（描述：==文本==）
  5. "清除行内代码格式"（描述：`代码`）
- **视觉特征**：
  - 点击展开下拉列表，显示所有选项
  - 每个选项左侧有复选框，右侧有选项名称和描述
  - 选中的选项会有蓝色背景和勾选标记
  - 选中后显示为"已选择 X 项"或具体选项名称
- **功能说明**：用户可以选择要清除的基础文本格式类型。

##### 5. 链接和媒体选择（条件显示）

当"一键清除所有格式"关闭时，显示此设置项。

- **控件类型**：MultiSelect多选下拉框
- **标签**："链接和媒体"
- **描述**："选择要清除的链接和媒体格式"
- **占位符**："选择要清除的链接和媒体格式"
- **选项列表**：
  1. "清除链接格式"（描述：保留链接文本）
  2. "清除图片格式"（描述：移除图片引用）
- **功能说明**：用户可以选择是否清除链接和图片格式，清除链接时会保留链接文本。

##### 6. 结构格式选择（条件显示）

当"一键清除所有格式"关闭时，显示此设置项。

- **控件类型**：MultiSelect多选下拉框
- **标签**："结构格式"
- **描述**："选择要清除的结构性格式"
- **占位符**："选择要清除的结构格式"
- **选项列表**：
  1. "清除标题格式"（描述：# ## ###）
  2. "清除引用格式"（描述：> 引用文本）
  3. "清除列表格式"（描述：- * + 和数字列表）
  4. "清除表格格式"（描述：移除表格结构）
- **功能说明**：用户可以选择要清除的文档结构元素格式，清除表格时会保留内容但移除表格结构。

##### 7. 高级格式选择（条件显示）

当"一键清除所有格式"关闭时，显示此设置项。

- **控件类型**：MultiSelect多选下拉框
- **标签**："高级格式"
- **描述**："选择要清除的高级格式和特殊元素"
- **占位符**："选择要清除的高级格式"
- **选项列表**：
  1. "清除注释"（描述：%% 注释 %%）
  2. "清除脚注"（描述：[^1] 和脚注定义）
  3. "清除数学块"（描述：$$ 数学公式 $$ 和 $ 行内公式 $）
  4. "清除属性"（描述：--- frontmatter ---）
- **功能说明**：用户可以选择清除高级格式元素，如注释、脚注、数学公式和YAML frontmatter属性。

##### 8. 需要确认选项

这是界面底部的通用设置项。

- **控件类型**：Toggle滑动开关
- **标签**："需要确认"
- **描述**："执行前显示确认对话框"
- **默认状态**：关闭
- **功能说明**：开启后，在执行格式清除操作前会显示确认对话框，防止误操作。

##### 9. 确认消息（条件显示）

当"需要确认"选项开启时，显示此设置项。

- **控件类型**：文本输入框
- **标签**："确认消息"
- **描述**："自定义确认对话框中显示的消息"
- **占位符**："确认要执行此清理操作吗？"
- **功能说明**：用户可以自定义确认对话框中显示的消息文本。

#### 界面视觉特征

##### 整体样式
- 界面采用Obsidian的原生设计语言，与整体应用风格保持一致
- 背景色使用Obsidian的主题变量，适应明暗主题切换
- 各设置项之间有1px的边框分隔，增强视觉层次感
- 鼠标悬停时，设置项会有轻微的背景色变化和圆角效果

##### 字体和间距
- 标签使用中等大小的字体（var(--font-ui-medium)），字重为500
- 描述文本使用较小的字体（var(--font-ui-smaller)），颜色较淡
- 控件区域与信息区域之间有24px的间距
- 各设置项之间有16px的垂直内边距

##### 交互效果
- Toggle开关有平滑的过渡动画效果
- MultiSelect下拉框展开时有淡入效果
- 所有交互元素都有悬停状态变化
- 禁用状态的控件有透明度变化和鼠标样式变化

##### 响应式设计
- 在小屏幕设备上，布局会自动调整为垂直排列
- MultiSelect下拉框的最大高度会适应屏幕尺寸
- 文件路径输入框会自动调整宽度以适应屏幕

```


## 二、删除文件/文件夹功能:

```markdown
### 功能目标与预期效果

本功能旨在为用户提供一种便捷方式，删除Obsidian仓库中的文件或文件夹。用户可以选择删除单个或多个文件/文件夹，并可以配置递归删除选项以及确认机制，确保删除操作的安全性和灵活性。

### 功能需求详细描述

1. **文件来源设置**
   - 支持设置文件来源为当前文件或指定文件/文件夹
   - 指定文件时支持选择Obsidian仓库中的所有类型文件（包括图片、PDF、音频等非Markdown格式文件）
   - 支持同时选择多个文件/文件夹进行批量删除

2. **处理流程**
   - 确认用户选择的文件/文件夹存在
   - 根据用户设置的递归选项，确定删除范围
   - 如果启用确认机制，显示确认对话框
   - 执行删除操作
   - 记录删除日志和删除的文件/文件夹路径

3. **删除文件夹选项**
   - 递归删除：删除文件夹及其所有子文件和子文件夹
   - 非递归删除-仅文件：仅删除文件夹下的文件，保留子文件夹结构
   - 非递归删除-仅文件夹：仅删除文件夹下的空子文件夹，保留所有文件

### Obsidian兼容性要求

- 使用Obsidian提供的文件系统API进行文件和文件夹操作
- 遵循Obsidian的文件安全操作规范，确保不会影响Obsidian的核心功能
- 支持Obsidian的文件选择器组件，实现与Obsidian原生交互体验一致的文件选择
- 删除操作应适配Obsidian的文件变更监听机制，确保文件浏览器视图及时更新

### 性能与安全考虑

- 批量删除时采用异步操作，避免界面卡顿
- 必须提供确认机制选项，尤其在递归删除时，防止误操作
- 操作前检查文件权限，确保有足够权限执行删除操作
- 提供操作日志，记录删除的文件路径和时间
- 添加错误处理机制，确保部分文件删除失败不影响整体操作
- 递归删除大型文件夹时，应提供进度指示和取消选项

### 设置界面详细描述

界面使用与文本清理功能相同的组件风格和布局原则。

#### 设置项详细描述

##### 1. 目标模式选择

- **控件类型**：下拉选择框
- **标签**："目标模式"
- **描述**："选择要删除的文件/文件夹来源"
- **选项**：
  - "current"（当前文件）
  - "specified"（指定文件/文件夹）
- **默认状态**：当前文件
- **功能说明**：用户可以选择是删除当前活动文件，还是删除指定的文件/文件夹。

##### 2. 目标文件/文件夹配置（条件显示）

当用户选择"指定文件/文件夹"模式时，会显示此设置项。

- **控件类型**：文件/文件夹路径列表（动态添加/删除）
- **标签**："目标路径"
- **描述**："指定要删除的文件或文件夹路径，支持多个路径"
- **界面元素**：
  - 路径输入框（支持自动补全、文件选择器和字段引用）
  - 添加按钮（带加号图标）
  - 删除按钮（带垃圾桶图标）
- **功能说明**：用户可以添加多个文件/文件夹路径，系统会依次处理这些路径。支持所有Obsidian能够识别的文件类型。

##### 3. 删除类型选择

- **控件类型**：单选按钮组
- **标签**："删除类型"
- **描述**："选择删除文件还是文件夹"
- **选项**：
  - "文件"
  - "文件夹"
- **默认状态**："文件"
- **功能说明**：用户可以明确指定要删除的是文件还是文件夹，影响后续设置项的显示。

##### 4. 文件夹删除选项（条件显示）

当用户选择删除类型为"文件夹"时，会显示此设置项。

- **控件类型**：单选按钮组
- **标签**："文件夹删除选项"
- **描述**："选择如何处理文件夹内容"
- **选项**：
  - "递归删除"（删除文件夹及其所有内容）
  - "仅删除文件"（只删除文件夹中的文件，保留子文件夹）
  - "仅删除文件夹"（只删除空的子文件夹，保留文件）
- **默认状态**："递归删除"
- **功能说明**：用户可以选择文件夹删除的方式，控制删除的范围。

##### 5. 需要确认选项

- **控件类型**：Toggle滑动开关
- **标签**："需要确认"
- **描述**："执行前显示确认对话框"
- **默认状态**：开启（考虑到删除操作的不可逆性，默认开启确认机制）
- **功能说明**：开启后，在执行删除操作前会显示确认对话框，防止误操作。

##### 6. 确认消息（条件显示）

当"需要确认"选项开启时，会显示此设置项。

- **控件类型**：文本输入框
- **标签**："确认消息"
- **描述**："自定义确认对话框中显示的消息"
- **占位符**："确认要删除选定的文件/文件夹吗？此操作不可撤销。"
- **功能说明**：用户可以自定义确认对话框中显示的警告消息文本。

```

## 三、删除文件内容功能:
```markdown
### 功能目标与预期效果

本功能旨在为用户提供精确控制文件内容删除的方式，支持删除整个文件内容或仅删除特定标题下的内容。用户可以根据需要选择删除范围，提高内容管理的灵活性。

### 功能需求详细描述

1. **文件来源设置**
   - 支持设置文件来源为当前文件或指定文件
   - 指定文件时支持选择Obsidian仓库中的所有类型文件（包括图片、PDF、音频等非Markdown格式文件）
   - 特定情况下（如删除指定标题下内容）仅支持Markdown格式文件

2. **处理流程**
   - 读取文件内容
   - 根据用户设置的删除类型和范围确定删除部分
   - 执行内容删除操作
   - 将更新后的内容写回文件
   - 记录操作日志

3. **删除选项**
   - 删除整个文件内容：可选择删除全部内容（包括属性和正文）或仅删除正文（保留YAML front matter）
   - 删除指定标题下内容：可选择不同的删除范围策略

4. **标题删除范围策略**
   - 删除到同级或更高级标题：从指定标题开始删除，直到遇到同级或更高级标题
   - 删除标题下所有内容：从指定标题开始删除，直到文档结束或遇到下一个任意标题
   - 仅删除标题下正文：仅删除指定标题与下一个标题之间的内容，保留所有标题

### Obsidian兼容性要求

- 使用Obsidian提供的文件读写API进行内容操作
- 支持Obsidian的Markdown解析功能，正确识别标题层级
- 确保操作后文档仍然符合Obsidian的Markdown标准
- 在操作过程中保持与Obsidian编辑器视图的同步更新

### 性能与安全考虑

- 处理大型文件时采用异步操作，避免界面卡顿
- 提供确认机制，防止内容误删
- 操作前可选备份原始内容，支持操作回滚
- 添加错误处理机制，确保操作失败不会损坏原始文件
- 提供操作日志，记录删除的内容范围和时间

### 设置界面详细描述

界面使用与文本清理功能相同的组件风格和布局原则。

#### 设置项详细描述

##### 1. 目标模式选择

- **控件类型**：下拉选择框
- **标签**："目标模式"
- **描述**："选择要操作的文件来源"
- **选项**：
  - "current"（当前文件）
  - "specified"（指定文件）
- **默认状态**：当前文件
- **功能说明**：用户可以选择是对当前活动文件进行内容删除，还是对指定的文件进行操作。

##### 2. 目标文件配置（条件显示）

当用户选择"指定文件"模式时，会显示此设置项。

- **控件类型**：文件路径列表（动态添加/删除）
- **标签**："目标文件"
- **描述**："指定要处理的文件路径，支持多个文件"
- **界面元素**：
  - 文件路径输入框（支持自动补全、文件选择器和字段引用）
  - 添加按钮（带加号图标）
  - 删除按钮（带垃圾桶图标）
- **功能说明**：用户可以添加多个文件路径，系统会依次处理这些文件。

##### 3. 删除内容类型选择

- **控件类型**：单选按钮组
- **标签**："删除内容类型"
- **描述**："选择要删除的内容范围"
- **选项**：
  - "整个文件内容"
  - "指定标题下内容"（仅适用于Markdown文件）
- **默认状态**："整个文件内容"
- **功能说明**：用户可以选择删除整个文件内容或仅删除特定标题下的内容。

##### 4. 文件内容删除范围（条件显示）

当用户选择删除内容类型为"整个文件内容"时，会显示此设置项。

- **控件类型**：单选按钮组
- **标签**："删除范围"
- **描述**："选择要删除的内容范围"
- **选项**：
  - "删除全部内容"（包括属性和正文）
  - "仅删除正文"（保留YAML front matter属性）
- **默认状态**："删除全部内容"
- **功能说明**：用户可以选择是删除文件的全部内容，还是保留YAML front matter属性。

##### 5. 标题指定（条件显示）

当用户选择删除内容类型为"指定标题下内容"时，会显示此设置项。

- **控件类型**：文本输入框
- **标签**："目标标题"
- **描述**："输入要删除内容的标题名称（不含#符号）"
- **占位符**："例如：项目概述"
- **功能说明**：用户可以输入要删除内容的标题名称，系统将搜索此标题并删除其下内容。

##### 6. 标题内容删除范围（条件显示）

当用户选择删除内容类型为"指定标题下内容"时，会显示此设置项。

- **控件类型**：单选按钮组
- **标签**："标题内容删除范围"
- **描述**："选择删除标题下内容的范围"
- **选项**：
  - "删除到同级或更高级标题"（从指定标题删除到下一个同级或更高级标题）
  - "删除所有子内容"（删除标题下所有内容，不管下面标题级别）
  - "仅删除标题下正文"（仅删除当前标题到下一个标题之间的内容）
- **默认状态**："删除到同级或更高级标题"
- **功能说明**：用户可以精确控制标题下内容的删除范围。

##### 7. 需要确认选项

- **控件类型**：Toggle滑动开关
- **标签**："需要确认"
- **描述**："执行前显示确认对话框"
- **默认状态**：开启（考虑到删除操作的不可逆性，默认开启确认机制）
- **功能说明**：开启后，在执行内容删除操作前会显示确认对话框，防止误操作。

##### 8. 确认消息（条件显示）

当"需要确认"选项开启时，会显示此设置项。

- **控件类型**：文本输入框
- **标签**："确认消息"
- **描述**："自定义确认对话框中显示的消息"
- **占位符**："确认要删除选定的内容吗？此操作不可撤销。"
- **功能说明**：用户可以自定义确认对话框中显示的警告消息文本。
```

## 用户交互流程

1. 用户在表单动作中选择"文本"功能
2. 显示文本操作（选择这个显示的就是一个空白的设置页面）和文本清理子功能选项
3. 选择文本清理子功能
4. 根据需要选择子功能：清除文本格式、删除文件/文件夹或删除文件内容
5. 配置相应的设置选项
6. 点击执行按钮
7. 如启用确认机制，系统显示确认对话框
8. 用户确认后执行操作
9. 操作完成后显示状态反馈（成功/失败）
10. 如果操作失败，提供错误详情和可能的解决方案

